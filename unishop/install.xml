<?xml version="1.0" encoding="UTF-8"?>
<modification>
<name>UniShop2 template</name>
<code>UniShop2 template</code>
<version>2.9.3.0</version>
<author>UniShop2</author>
	<file path="catalog/controller/common/{column_left,column_right}.php">
		<operation error="skip">
			<search><![CDATA[return $this->load->view]]></search>
			<add position="before"><![CDATA[
			$data['route'] = $route;
			
			$uniset = $this->config->get('config_unishop2');
			$menu_schema = isset($uniset['menu_schema']) ? $uniset['menu_schema'] : [];
			$data['menu_expanded'] = ($uniset['menu_type'] == 1 && in_array($route, $menu_schema)) ? true : false;
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/common/header.php">
		<operation error="skip">
			<search><![CDATA[return $this->load->view]]></search>
			<add position="before"><![CDATA[
			$data = array_merge($data, $this->load->controller('extension/module/uni_new_data', ['type' => 'header']));
			]]></add>
		</operation>		
	</file>
	<file path="catalog/controller/common/menu.php">	
		<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
				$uniset = $this->config->get('config_unishop2');
				
				$this->load->model('tool/image');
				
				$new_data = $this->load->controller('extension/module/uni_new_data', ['type' => 'menu']);
				
				$data = isset($data) ? array_merge($data, $new_data) : $new_data;
				
				$third_level_limit = isset($uniset['menu']['third_level']['limit']) ? $uniset['menu']['third_level']['limit'] : 0;
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$data['categories'] = array();]]></search>
			<add position="replace"><![CDATA[
			$cache_name = 'category.unishop.menu.'.(int)$this->config->get('config_language_id').'.'.(int)$this->config->get('config_store_id');
			
			$data['categories'] = isset($uniset['menu']['caching']['status']) ? $this->cache->get($cache_name) : [];
			
			if(!$data['categories']) {
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$children_data = array();]]></search>
			<add position="before"><![CDATA[
			$show_child_image = in_array($category['category_id'], $uniset['menu']['second_level']['image']) ? true : false;
			
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$category['name'],]]></search>
			<add position="after"><![CDATA[
			'icon'		=> isset($data['icons'][$category['category_id']]) ? $data['icons'][$category['category_id']] : [],
			'banner'	=> isset($data['banners'][$category['category_id']]) && $category['column'] > 1 ? $data['banners'][$category['category_id']] : [],
			'sort_order'=> $category['sort_order'],
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[// Level 1]]></search>
			<add position="replace" offset="-6"><![CDATA[		
				$children2 = $this->model_catalog_category->getCategories($child['category_id']);
					
				$children_data2 = [];
				$child_count = 0;
				$more = '';
				$show_more = $third_level_limit && $third_level_limit < count($children2) ? true : false;
			
				foreach ($children2 as $child2) {
					if(isset($uniset['menu_links_show']) ? $child2['top'] : 1) {
						$children_data2[] = [
							'name'  		=> $child2['name'],
							'category_id'	=> $child2['category_id'],
							'href'  		=> $this->url->link('product/category', 'path='.$category['category_id'].'_'.$child['category_id'].'_'.$child2['category_id'], true),
							'sort_order'	=> $child2['sort_order']
						];
							
						$child_count++;
					}
						
					if($show_more && $third_level_limit == $child_count) {
						$more = count($children2);
						break;
					}
				}
				
				if(isset($data['landinglinks'][$child['category_id']])) {
					$children_data2 = array_merge($children_data2, $data['landinglinks'][$child['category_id']]);
					
					array_multisort(array_column($children_data2, 'sort_order'), SORT_ASC, $children_data2);
				}
					
				if(isset($uniset['menu_links_show']) ? $child['top'] : 1) {
					$children_data[] = [
						'name'       	=> $child['name'],
						'category_id'	=> $child['category_id'],
						'image'			=> $show_child_image && $children_data2 && $child['image'] ? $this->model_tool_image->resize($child['image'], 100, 100) : '',
						'children'   	=> $children_data2,
						'href'        	=> $this->url->link('product/category', 'path='.$category['category_id'].'_'.$child['category_id'], true),
						'sort_order'	=> $child['sort_order'],
						'more'			=> $more
					];
				}
			}
			
			if (isset($data['landinglinks'][$category['category_id']])) {
				$children_data = array_merge($children_data, $data['landinglinks'][$category['category_id']]);
					
				array_multisort(array_column($children_data, 'sort_order'), SORT_ASC, $children_data);
			}
			
			// Level 1
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[return $this->load->view]]></search>
			<add position="before"><![CDATA[
			if($data['additional_link']) {
				$data['categories'] = array_merge($data['categories'], $data['additional_link']);
				
				if(count($data['categories']) > 1) {
					array_multisort(array_column($data['categories'], 'sort_order'), SORT_ASC, $data['categories']);
				}
			}
			
				if(isset($uniset['menu']['caching']['status'])){
					$this->cache->set($cache_name, $data['categories']);
				}
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/information/contact.php">
		<operation error="skip">
		<search><![CDATA[return !$this->error;]]></search>
		<add position="before"><![CDATA[
		if ($this->config->get('config_account_id')) {
			$this->load->language('extension/module/uni_othertext');
			$this->load->model('catalog/information');

			$information_info = $this->model_catalog_information->getInformation($this->config->get('config_account_id'));

			if ($information_info && !isset($this->request->post['agree'])) {
				$this->error['error_agree'] = sprintf($this->language->get('error_agree'), $information_info['title']);
			}
		}
		]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->response->setOutput($this->load->view('information/contact', $data));]]></search>
			<add position="before"><![CDATA[
			$this->load->language('extension/module/uni_othertext');
			$data['error_agree'] = isset($this->error['error_agree']) ? $this->error['error_agree'] : '';
			$data = array_merge($data, $this->load->controller('extension/module/uni_new_data', ['type' => 'contact']));
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/checkout/cart.php">
		<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			$this->load->language('extension/module/uni_othertext');
			$uniset = $this->config->get('config_unishop2');
			if(isset($uniset['checkout']['status']) && ($this->cart->getProducts() || !empty($this->session->data['vouchers'])) && !isset($this->request->server['HTTP_X_REQUESTED_WITH'])) {
				$this->response->redirect($this->url->link('checkout/uni_checkout', '', true)); 
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->response->redirect($this->url->link('checkout/cart'));]]></search>
			<add position="replace"><![CDATA[
			$uniset = $this->config->get('config_unishop2');
			if(!isset($uniset['checkout']['status'])) {
				$this->response->redirect($this->url->link('checkout/cart'));
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if (!$json) {]]></search>
			<add position="before"><![CDATA[
			if(!$this->config->get('config_stock_checkout') || $this->config->get('config_stock_warning')) {
				$params = [
					'product' 	=> $product_info,
					'quantity'	=> $quantity,
					'option' 	=> $option,
					'options' 	=> $product_options,
					'type' 		=> 'checkCartStock'
				];
			
				$checkCartStock = $this->load->controller('extension/module/uni_new_data', $params);
			
				if($checkCartStock) {
					$json['error']['stock'] = $checkCartStock;
				}
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$json['redirect']]]></search>
			<add position="before" offset="1"><![CDATA[
			$params = [
				'product' 	=> $product_info,
				'quantity'	=> $quantity,
				'option' 	=> $option,
				'options' 	=> $product_options,
				'type' 		=> 'cart'
			];
			
			$json['products'] = $this->load->controller('extension/module/uni_new_data', $params);
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/common/cart.php">
		<operation error="skip">
			<search><![CDATA[$data['text_items']]]></search>
			<add position="before"><![CDATA[
			$data['items'] = $this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0);
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$product['cart_id'],]]></search>
			<add position="after"><![CDATA[
			'product_id' => $product['product_id'],
			'minimum' 	 => $product['minimum'],
			'stock' 	 => $product['stock'] ? true : !(!$this->config->get('config_stock_checkout') || $this->config->get('config_stock_warning')),
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			$this->load->language('extension/module/uni_othertext');
			$uniset = $this->config->get('config_unishop2');
			$data['uni_checkout_href'] = isset($uniset['checkout']['status']) ? $this->url->link('checkout/uni_checkout', '', true) : '';
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/account/account.php|catalog/controller/extension/module/account.php">
		<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			$data['account_page'] = $this->config->get('config_unishop2')['account_page'];
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/account/order.php">
		<operation error="skip">
			<search><![CDATA[public function info() {]]></search>
			<add position="after"><![CDATA[
			$data['account_page'] = $this->config->get('config_unishop2')['account_page'];
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/account/register.php">
		<operation error="skip">
			<search><![CDATA[$this->load->language('account/register');]]></search>
			<add position="before"><![CDATA[
			$uniset = $this->config->get('config_unishop2');
			if(isset($uniset['register_form']['page'])) {
				$this->response->redirect($this->url->link('extension/module/uni_login_register/page', '', true)); 
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/common/footer.php">
		<operation error="skip">
			<search><![CDATA[return $this->load->view]]></search>
			<add position="before"><![CDATA[
			$data = array_merge($data, $this->load->controller('extension/module/uni_new_data', ['type' => 'footer']));
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/{carousel,banner}.php">	
		<operation error="skip">
			<search><![CDATA[$this->document->addStyle]]></search>
			<add position="replace"><![CDATA[//$this->document->addStyle]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->document->addScript]]></search>
			<add position="replace"><![CDATA[//$this->document->addScript]]></add>
		</operation>
	</file>
	<file path="catalog/controller/common/search.php">	
		<operation error="skip">
			<search><![CDATA[$this->load->language('common/search');]]></search>
			<add position="after"><![CDATA[
			$uniset = $this->config->get('config_unishop2');
			$this->load->language('extension/module/uni_othertext');
			
			$data['categories'] = [];
			
			$hide_category = $uniset['header']['search']['category'];
			$isMobile = $uniset['is_mobile'];
			
			$hide_cat = ($hide_category == 'always') || ($hide_category == 'only_mobile' && $isMobile) ? true : false;
			
			if(!$hide_cat) {
				$cache_name = 'category.unishop.header.search.'.(int)$this->config->get('config_language_id').'.'.(int)$this->config->get('config_store_id');
		
				$categories = $this->cache->get($cache_name);
		
				if(!$categories) {
					$this->load->model('catalog/category');
					$categories = $this->model_catalog_category->getCategories(0);
			
					if($categories){
						$this->cache->set($cache_name, $categories);
					}
				}
			
				foreach ($categories as $category) {
					$data['categories'][] = [
						'category_id' => $category['category_id'],
						'name'        => $category['name'],
					];
				}
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/information/information.php">
		<operation error="skip">
			<search><![CDATA[$data['description']]]></search>
			<add position="after" offset="1"><![CDATA[
			$data = array_merge($data, $this->load->controller('extension/module/uni_new_data', ['type' => 'information', 'information_info' => $information_info]));
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/category.php">	
		<operation error="skip">
			<search><![CDATA[if ($category['category_id'] == $data['category_id']) {]]></search>
			<add position="replace"><![CDATA[if ($category['category_id'] > 0) {]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$data['categories'] = array();]]></search>
			<add position="replace"><![CDATA[
			$uniset = $this->config->get('config_unishop2');
			$cache_name = 'category.module.'.(int)$this->config->get('config_language_id').'.'.(int)$this->config->get('config_store_id');
			$data['categories'] = isset($uniset['menu']['caching']['status']) ? $this->cache->get($cache_name) : [];
			if(!$data['categories']) {
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[return $this->load->view]]></search>
			<add position="before"><![CDATA[
				if(isset($uniset['menu']['caching']['status'])) {
					$this->cache->set($cache_name, $data['categories']);
				}
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/filter.php">	
		<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			$this->load->language('extension/module/uni_othertext');
			$uniset = $this->config->get('config_unishop2');
			$data['ajax_filter'] = isset($uniset['ajax_filter']) ? true : false;
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/category.php">
		<operation error="skip">
			<search><![CDATA[$this->model_catalog_category->getCategories($category_id);]]></search>
			<add position="replace"><![CDATA[!isset($uniset['catalog']['subcategory']['disabled']) ? $this->model_catalog_category->getCategories($category_id) : [];]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$data['categories'][] = array(]]></search>
			<add position="after"><![CDATA[
			'thumb' => isset($uniset['catalog']['subcategory']['image']) && $result['image'] ? $this->model_tool_image->resize($result['image'], $this->config->get('theme_'.$this->config->get('config_theme').'_image_category_width'), $this->config->get('theme_'.$this->config->get('config_theme').'_image_category_height')) : '',
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$data['categories'] = array();]]></search>
			<add position="before"><![CDATA[
			$data['banner_in_category'] = isset($page) && $page == 1 && $this->config->get('module_uni_banner_in_category_status') ? $this->load->controller('extension/module/uni_banner_in_category', $category_id) : '';
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/manufacturer.php">
		<operation error="skip">
			<search><![CDATA[public function info]]></search>
			<add position="after" offset="1"><![CDATA[
			$uniset = $this->config->get('config_unishop2');
			$lang_id = $this->config->get('config_language_id');
			
			$this->load->model('extension/module/uni_new_data');
			$this->load->language('extension/module/uni_othertext');
			
			$new_data = $this->load->controller('extension/module/uni_new_data', ['type' => 'catalog']);
			$data = isset($data) ? array_merge($data, $new_data) : $new_data;
			
			$currency = $this->session->data['currency'];
			$config_tax = $this->config->get('config_tax'); 
			$stock_warning = (!$this->config->get('config_stock_checkout') || $this->config->get('config_stock_warning')) ? true : false;
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/search.php">
		<operation error="skip">
			<search index="0"><![CDATA[model_catalog_product]]></search>
			<add position="before" offset="1"><![CDATA[
			if(isset($uniset['search']['status'])) {
				$this->load->model('extension/module/uni_search');
				$this->load->language('product/uni_search');
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[model_catalog_product]]></search>
			<add position="replace"><![CDATA[{isset($uniset['search']['status']) ? 'model_extension_module_uni_search' : 'model_catalog_product'}]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[foreach ($results as $result) {]]></search>
			<add position="before"><![CDATA[
			$data['categories_search'] = $data['manufacturers_search'] = $data['product_categories_search'] = [];
			
			if(isset($uniset['search']['status'])) {
				$data = array_merge($data, $this->load->controller('product/uni_search', ['filter_data' => $filter_data, 'products' => array_column($results, 'product_id')]));
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/special.php">
		<operation error="skip">
			<search index="0"><![CDATA[model_catalog_product]]></search>
			<add position="before" offset="1"><![CDATA[
			$special_page = $uniset['catalog']['special_page'];
			
			if(isset($special_page['product_category'])) {
				$this->load->model('extension/module/uni_special');
				$this->load->language('product/uni_special');
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[model_catalog_product]]></search>
			<add position="replace"><![CDATA[{isset($special_page['product_category']) ? 'model_extension_module_uni_special' : 'model_catalog_product'}]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[getTotalProductSpecials()]]></search>
			<add position="replace"><![CDATA[getTotalProductSpecials($filter_data)]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[foreach ($results as $result) {]]></search>
			<add position="before"><![CDATA[
			$data = array_merge($data, $this->load->controller('product/uni_special'));
				
			if(isset($data['breadcrumbs_new'])) {
				$data['breadcrumbs'] = array_merge($data['breadcrumbs'], $data['breadcrumbs_new']);
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA['limit' => $limit]]></search>
			<add position="replace"><![CDATA[
			'limit' => $limit,
			'filter_category_id' => isset($this->request->get['cat_id']) ? (int)$this->request->get['cat_id'] : 0,
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$url = '';]]></search>
			<add position="after"><![CDATA[
			if (isset($this->request->get['cat_id'])) {
				$url .= '&cat_id=' . (int)$this->request->get['cat_id'];
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/{category,search,special,manufacturer}.php">
		<operation error="skip">
			<search><![CDATA[$sort = 'p.sort_order';]]></search>
			<add position="replace"><![CDATA[$sort = isset($uniset['catalog']['default_sort']) ? explode('|', $uniset['catalog']['default_sort'])[0] : 'p.sort_order';]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$order = 'ASC';]]></search>
			<add position="replace"><![CDATA[$order = isset($uniset['catalog']['default_sort']) ? explode('|', $uniset['catalog']['default_sort'])[1] : 'ASC';]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[sort($limits);]]></search>
			<add position="before"><![CDATA[
			if(isset($uniset['catalog']['limit']['status'])) {
				$new_limits = array_unique(explode(',', $uniset['catalog']['limit']['value']));

				$limits = $new_limits ? $new_limits : $limits;
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA['&limit=' . $value)]]></search>
			<add position="replace"><![CDATA['&limit=' . (int)$value)]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$data['sort'] = $sort;]]></search>
			<add position="before"><![CDATA[
			if(isset($uniset['catalog']['disabled_sorts']) && isset($data['sorts'])) {
				foreach($data['sorts'] as $key => $sorts) {
					if(in_array(explode('-', $sorts['value'])[0], $uniset['catalog']['disabled_sorts'])) {
						unset($data['sorts'][$key]);
					}
				}
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/{product,extension/module,blog}/{category,product,search,special,manufacturer,latest,featured,bestseller,random,popular,article,featured_product,products_attributes}.php">
		<operation error="skip">
			<search><![CDATA[public function index]]></search>
			<add position="after" offset="1"><![CDATA[
			$uniset = $this->config->get('config_unishop2');
			$lang_id = $this->config->get('config_language_id');
			
			$this->load->model('extension/module/uni_new_data');
			$this->load->language('extension/module/uni_othertext');
			
			$data['type_view'] = isset($setting['name']) && in_array($setting['name'], $uniset['module_type_view']) ? 'grid' : 'carousel';
			
			$data = array_merge($data, $this->load->controller('extension/module/uni_new_data', ['type' => 'catalog']));
			
			$data['img_width'] = isset($setting['width']) ? $setting['width'] : $data['img_width'];
			$data['img_height'] = isset($setting['height']) ? $setting['height'] : $data['img_height'];
			
			$currency = $this->session->data['currency'];
			$config_tax = $this->config->get('config_tax'); 
			
			$stock_warning = (!$this->config->get('config_stock_checkout') || $this->config->get('config_stock_warning')) ? true : false;
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="before"><![CDATA[
			$result = isset($product_info) && isset($setting) ? $product_info : $result;
			$new_data = $this->model_extension_module_uni_new_data->getNewData($result, ['width' => $data['img_width'], 'height' => $data['img_height']]);
			
			if($new_data['special_date_end']) {
				$data['show_timer'] = true;
			}
			
			if((int)$result['reviews']) {
				$data['show_rating'] = true;
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="after"><![CDATA[
			'rating_new'		=> $result['rating'],
			'text_reviews'		=> $new_data['text_reviews'],
			'quantity' 			=> $result['quantity'],
			'minimum' 			=> $result['minimum'] ? $result['minimum'] : 1,
			'maximum'			=> $stock_warning ? $result['quantity'] : 100000,
			'price_value' 		=> $this->currency->format($this->tax->calculate($result['price'], $result['tax_class_id'], $config_tax), $currency, false, false),
			'special_value' 	=> $this->currency->format($this->tax->calculate($result['special'], $result['tax_class_id'], $config_tax), $currency, false, false),
			'model'				=> $new_data['model'],
			'additional_image'	=> $new_data['additional_image'],
			'stickers' 			=> $new_data['stickers'],
			'special_date_end' 	=> $new_data['special_date_end'],
			'quantity_indicator'=> $new_data['quantity_indicator'],
			'discounts'			=> $new_data['discounts'],
			'attributes' 		=> $new_data['attributes'],
			'options'			=> $new_data['options'],
			'show_description'	=> $new_data['show_description'],
			'show_quantity'		=> $new_data['show_quantity'],
			'cart_btn_icon'		=> $new_data['cart_btn_icon'],
			'cart_btn_text'		=> $new_data['cart_btn_text'],
			'cart_btn_class'	=> $new_data['cart_btn_class'],
			'quick_order'		=> $new_data['quick_order'],
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/product.php">
		<operation error="skip">
			<search><![CDATA[$this->document->addScript('catalog/view/javascript/jquery/datetimepicker/]]></search>
			<add position="replace"><![CDATA[//$this->document->addScript('catalog/view/javascript/jquery/datetimepicker/]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->document->addStyle('catalog/view/javascript/jquery/datetimepicker/]]></search>
			<add position="replace"><![CDATA[//$this->document->addStyle('catalog/view/javascript/jquery/datetimepicker/]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->document->addScript('catalog/view/javascript/jquery/magnific/]]></search>
			<add position="replace"><![CDATA[//$this->document->addScript('catalog/view/javascript/jquery/magnific/]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->document->addStyle('catalog/view/javascript/jquery/magnific/]]></search>
			<add position="replace"><![CDATA[//$this->document->addStyle('catalog/view/javascript/jquery/magnific/]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[image_popup_height')),]]></search>
			<add position="after"><![CDATA[
			'small' => $this->model_tool_image->resize($result['image'], $this->config->get('theme_'.$this->config->get('config_theme') . '_image_thumb_width'), $this->config->get('theme_'.$this->config->get('config_theme') . '_image_thumb_height')),
			]]></add>
		</operation>	
		<operation error="skip">
			<search><![CDATA[$data['images'] = array();]]></search>
			<add position="before"><![CDATA[
			$data['small'] = $this->model_tool_image->resize($product_info['image'] ? $product_info['image'] : 'no_image.jpg', $this->config->get('theme_'.$this->config->get('config_theme').'_image_additional_width'), $this->config->get('theme_'.$this->config->get('config_theme') . '_image_additional_height'));
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->request->get['product_id']) as $option) {]]></search>
			<add position="before"><![CDATA[
			$o_quantity = 0;
			$required = false;
			
			if(isset($uniset['options']['img_prop'])) {
				$option_img_small_w = $option_img_small_h = $this->config->get('theme_'.$this->config->get('config_theme').'_image_thumb_height');
				$option_img_full_w = $option_img_full_h = $this->config->get('theme_'.$this->config->get('config_theme').'_image_popup_height');
			} else {
				$option_img_small_w = $this->config->get('theme_'.$this->config->get('config_theme').'_image_thumb_width');
				$option_img_small_h = $this->config->get('theme_'.$this->config->get('config_theme').'_image_thumb_height');
				$option_img_full_w = $this->config->get('theme_'.$this->config->get('config_theme').'_image_popup_width');
				$option_img_full_h = $this->config->get('theme_'.$this->config->get('config_theme').'_image_popup_height');
			}
			
			$show_ended_option_value = isset($uniset['product']['option']['show_ended_value']) ? true : false;
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[($option_value['quantity'] > 0)]]></search>
			<add position="replace"><![CDATA[($option_value['quantity'] > 0) || $show_ended_option_value]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->model_tool_image->resize($option_value['image'], 50, 50),]]></search>
			<add position="replace"><![CDATA[$option_value['image'] ? $this->model_tool_image->resize($option_value['image'], $option_img_small_w/4, $option_img_small_h/4) : '',]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA['price'                   => $price,]]></search>
			<add position="before"><![CDATA[
			'small' 		=> $this->model_tool_image->resize($option_value['image'], $option_img_small_w, $option_img_small_h),
			'full' 			=> $this->model_tool_image->resize($option_value['image'], $option_img_full_w, $option_img_full_h),
			'price_value' 	=> $this->tax->calculate($option_value['price'], $product_info['tax_class_id'], $this->config->get('config_tax'))*$this->currency->getValue($currency),$option_value['price'],
			'ended'			=> $option_value['subtract'] && $option_value['quantity'] <= 0 ? true : false,
			'maximum' 		=> $option_value['subtract'] ? $option_value['quantity'] : 100000,
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->request->get['product_id']) as $option) {]]></search>
			<add position="after"><![CDATA[			
			if($option['required'] && ($option['type'] == 'select' || $option['type'] == 'radio' || $option['type'] == 'checkbox')) {
				$o_quantity = 0;
				$required = true;
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$data['options'][] = array(]]></search>
			<add position="before" offset="2"><![CDATA[
			$o_quantity = $o_quantity + $option_value['quantity'];
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$data['options'][] = array(]]></search>
			<add position="before" offset="1"><![CDATA[
			if($option['required'] && ($option['type'] == 'select' || $option['type'] == 'radio' || $option['type'] == 'checkbox')) {
				$o_quantity_arr[] = $o_quantity;
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if ($product_info['minimum']) {]]></search>
			<add position="before"><![CDATA[
			$product_info['options'] = $data['options'] ? true : false;
			$product_info['options_quantity'] = $required ? min($o_quantity_arr) : $o_quantity;
			$product_info['category_name'] = isset($category_info['name']) ? $category_info['name'] : '';
			$product_info['type'] = 'product';
			
			$data = array_merge($data, $this->load->controller('extension/module/uni_new_data', $product_info));
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if (!isset($json['error'])) {]]></search>
			<add position="before"><![CDATA[
			$this->load->language('extension/module/uni_othertext');
			$this->load->language('extension/module/uni_reviews');
			
			$uniset = $this->config->get('config_unishop2');
			
			if(isset($uniset['product']['review']['plus_minus']['status']) && isset($uniset['product']['review']['plus_minus']['required'])) {
				if ((utf8_strlen($this->request->post['plus']) < 3) || (utf8_strlen($this->request->post['plus']) > 1000)) {
					$json['error'] = $this->language->get('error_plus');
				}
				if ((utf8_strlen($this->request->post['minus']) < 3) || (utf8_strlen($this->request->post['minus']) > 1000)) {
					$json['error'] = $this->language->get('error_minus');
				}
			}
			
			if ($this->config->get('config_account_id')) {
				$this->load->model('catalog/information');

				$information_info = $this->model_catalog_information->getInformation($this->config->get('config_account_id'));

				if ($information_info && !isset($this->request->post['agree'])) {
					$json['error'] = sprintf($this->language->get('error_agree'), $information_info['title']);
				}
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/{blog_latest,blog_featured,featured_article,featured_product}.php">
		<operation error="skip">
			<search><![CDATA[public function index]]></search>
			<add position="after" offset="1"><![CDATA[
			$this->document->addStyle('catalog/view/theme/unishop2/stylesheet/blog.css');
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$result = isset($product_info) && isset($setting) ? $product_info : $result;]]></search>
			<add position="before"><![CDATA[
			$result = isset($product) && $setting ? $product : $result;
		]]></add>
		</operation>
	</file>
	<file path="catalog/controller/blog/*.php">
		<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			$this->document->addStyle('catalog/view/theme/unishop2/stylesheet/blog.css');
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->document->addScript('catalog/view/javascript/jquery/datetimepicker/moment.js');]]></search>
			<add position="replace"><![CDATA[
			$this->document->addScript('catalog/view/javascript/jquery/datetimepicker/moment/moment.min.js');
			$this->document->addScript('catalog/view/javascript/jquery/datetimepicker/moment/moment-with-locales.min.js');
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/{product,account}/{compare,wishlist}.php">
		<operation error="skip">
			<search><![CDATA[public function index()]]></search>
			<add position="after"><![CDATA[
			$uniset = $this->config->get('config_unishop2');
			$lang_id = $this->config->get('config_language_id');
			$data['wishlist_btn_disabled'] = isset($uniset['wishlist']['disabled']) ? true : false;
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$product_info['product_id'],]]></search>
			<add position="after"><![CDATA[
			'quantity' 			=> $product_info['quantity'],
			'cart_btn_icon'		=> $product_info['quantity'] > 0 ? $uniset[$lang_id]['cart_btn_icon'] : $uniset[$lang_id]['cart_btn_icon_disabled'],
			'cart_btn_text'		=> $product_info['quantity'] > 0 ? $uniset[$lang_id]['cart_btn_text'] : $uniset[$lang_id]['cart_btn_text_disabled'],
			'cart_btn_class'	=> $product_info['quantity'] <= 0 ? $uniset['cart_btn_disabled'] : '',
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/account/order.php">
		<operation error="skip">
			<search><![CDATA[public function info()]]></search>
			<add position="after"><![CDATA[
			$uniset = $this->config->get('config_unishop2');
			$lang_id = $this->config->get('config_language_id');
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$product['quantity'],]]></search>
			<add position="after"><![CDATA[
			'product_id' 		=> $product_info['product_id'],
			'cart_btn_icon'		=> $product_info['quantity'] > 0 ? $uniset[$lang_id]['cart_btn_icon'] : $uniset[$lang_id]['cart_btn_icon_disabled'],
			'cart_btn_text'		=> $product_info['quantity'] > 0 ? $uniset[$lang_id]['cart_btn_text'] : $uniset[$lang_id]['cart_btn_text_disabled'],
			'cart_btn_class'	=> $product_info['quantity'] <= 0 ? $uniset['cart_btn_disabled'] : '',
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/mail/register.php">
		<operation error="skip">
			<search><![CDATA[$data['login']]]></search>
			<add position="before"><![CDATA[
			$this->load->language('extension/module/uni_othertext');
			
			if(isset($this->session->data['uni_add_customer'])) {
				$data['text_user_login'] = $this->session->data['uni_add_customer']['email'];
				$data['text_user_password'] = $this->session->data['uni_add_customer']['password'];
			} else {
				$data['text_user_login'] = '';
				$data['text_user_password'] = '';
			}
			
			$data['text_subscribe'] = isset($this->session->data['uni_subscribe_text']) ? $this->session->data['uni_subscribe_text'] : '';
			]]></add>
		</operation>
	</file>
	<file path="catalog/model/design/layout.php">
		<operation error="skip">
			<search><![CDATA[return $query->rows;]]></search>
			<add position="before"><![CDATA[
			$uniset = $this->config->get('config_unishop2');
			
			$home_banners_layouts = isset($uniset['home_banners_layout']) ? explode(',', $uniset['home_banners_layout']) : [1];
			
			if(isset($uniset['home_banners_position']) && $uniset['home_banners_position'] == $position && in_array($layout_id, $home_banners_layouts)) {
				$query->rows[] = [
					'layout_module_id'	=> 99999999,
					'layout_id'			=> $layout_id,
					'code' 				=> 'uni_home_banner',
					'position' 			=> $uniset['home_banners_position'],
					'sort_order'		=> $uniset['home_banners_position_n']
				];
				
				$this->config->set('module_uni_home_banner_status', 1);
				
				if(count($query->rows) > 1) {
					array_multisort(array_column($query->rows, 'sort_order'), SORT_ASC, $query->rows);
				}
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/model/catalog/product.php">
		<operation error="skip">
			<search><![CDATA[$query->row['rating']),]]></search>
			<add position="replace"><![CDATA[$query->row['rating'], 1),]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if (isset($data['sort']) && in_array($data['sort'], $sort_data)) {]]></search>
			<add position="before"><![CDATA[
				$uniset = $this->config->get('config_unishop2');
				$sort_qty = '';
				
				if($uniset['sort_qty'] == 1){
					if(isset($data['sort']) && $data['sort'] == 'p.sort_order') {
						$sort_qty = '(p.quantity > 0) DESC,';
					}
				} elseif($uniset['sort_qty'] == 2) {
					$sort_qty = '(p.quantity > 0) DESC,';
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$sql .= " ORDER BY]]></search>
			<add position="replace"><![CDATA[$sql .= " ORDER BY ".$sort_qty."]]></add>
		</operation>
	</file>
	<file path="catalog/model/catalog/review.php">
		<operation error="skip">
			<search><![CDATA[, rating =]]></search>
			<add position="replace"><![CDATA[, plus = '".$this->db->escape(strip_tags($data['plus']))."', minus = '".$this->db->escape(strip_tags($data['minus']))."', admin_reply = '', rating =]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[r.author, r.rating, r.text,]]></search>
			<add position="replace"><![CDATA[r.author, r.rating, r.text, r.plus, r.minus, r.admin_reply, r.votes_plus, r.votes_minus,]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->load->language('mail/review');]]></search>
			<add position="after"><![CDATA[$this->load->language('extension/module/uni_reviews');]]></add>
		</operation>
		<operation error="skip">
            <search><![CDATA[$message .= html_entity_decode($data['text'], ENT_QUOTES, 'UTF-8') . "\n\n";]]></search>
            <add position="after"><![CDATA[
			$message .= $data['plus'] ? $this->language->get('text_review_plus')."\n".html_entity_decode($data['plus'], ENT_QUOTES, 'UTF-8')."\n\n" : '';
			$message .= $data['minus'] ? $this->language->get('text_review_minus')."\n".html_entity_decode($data['minus'], ENT_QUOTES, 'UTF-8')."\n\n" : '';
			$message .= $this->config->get('config_secure') ? HTTPS_SERVER.'admin/index.php?route=catalog/review/edit&review_id='.$review_id : HTTP_SERVER.'admin/index.php?route=catalog/review/edit&review_id='.$review_id;
			]]></add>
        </operation>
	</file>
	<file path="catalog/controller/startup/startup.php">
		<operation error="skip">
			<search><![CDATA[$this->registry->set('encryption']]></search>
			<add position="after" offset="0"><![CDATA[
			$this->load->model('extension/module/uni_settings');
			$this->model_extension_module_uni_settings->getSetting();
			]]></add>
		</operation>
	</file>
	
	<!-- for seourl and seopro -->
	
	<file path="catalog/controller/startup/seo_url.php">
		<operation error="skip">
			<search><![CDATA[if ($url[0] == 'information_id') {]]></search>
			<add position="before"><![CDATA[
			if ($url[0] == 'news_id') {
				$this->request->get['news_id'] = $url[1];
			}
			
			if ($url[0] == 'news_category_id') {
				if (!isset($this->request->get['news_path'])) {
					$this->request->get['news_path'] = $url[1];
				} else {
					$this->request->get['news_path'] .= '_' . $url[1];
				}
			}
			
			if ($url[0] == 'gallery_id') {
				$this->request->get['gallery_id'] = $url[1];
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$url[0] != 'information_id']]></search>
			<add position="replace"><![CDATA[$url[0] != 'information_id' && $url[0] != 'news_id' && $url[0] != 'news_category_id' && $url[0] != 'gallery_id']]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[} elseif (isset($this->request->get['information_id'])) {]]></search>
			<add position="before"><![CDATA[
			} elseif (isset($this->request->get['news_id'])) {
				$this->request->get['route'] = 'information/uni_news_story';
			} elseif (isset($this->request->get['news_path'])) {
				$this->request->get['route'] = 'information/uni_news';
			} elseif (isset($this->request->get['gallery_id'])) {
				$this->request->get['route'] = 'information/uni_gallery';
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[($data['route'] == 'information/information' && $key == 'information_id')]]></search>
			<add position="replace"><![CDATA[($data['route'] == 'information/information' && $key == 'information_id') || ($data['route'] == 'information/uni_news_story' && $key == 'news_id') || ($data['route'] == 'information/uni_gallery' && $key == 'gallery_id')]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[} elseif ($key == 'path') {]]></search>
			<add position="before"><![CDATA[
			} elseif ($key == 'news_path') {
				$categories = explode('_', $value);

				foreach ($categories as $category) {
					$query = $this->db->query("SELECT * FROM `".DB_PREFIX."seo_url` WHERE `query` = 'news_category_id=".(int)$category."' AND store_id = '".(int)$this->config->get('config_store_id')."' AND language_id = '".(int)$this->config->get('config_language_id')."'");

					if ($query->num_rows && $query->row['keyword']) {
						$url .= '/' . $query->row['keyword'];
					} else {
						$url = '';

						break;
					}
				}

				unset($data[$key]);
			]]></add>
		</operation>
    </file>
	<file path="system/library/seopro.php">
		<operation error="skip">
			<search><![CDATA['information_id',]]></search>
			<add position="replace"><![CDATA['information_id', 'news_id', 'gallery_id',]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[} elseif (count($url) > 1) {]]></search>
			<add position="before"><![CDATA[
			} elseif($url[0] == 'news_category_id'){
				if (!isset($this->request->get['news_path'])) {
					$this->request->get['news_path'] = $url[1];
				} else {
					$this->request->get['news_path'] .= '_' . $url[1];
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->request->get['route'] = 'information/information';]]></search>
			<add position="after" offset="1"><![CDATA[
			if(isset($this->request->get['news_id'])) {
				if(isset($this->request->get['news_path'])) {
					unset($this->request->get['news_path']);
				}
				
				$news_path = $this->getPathByUniNewsStory((int)$this->request->get['news_id']);
					
				if ($news_path) {
					$this->request->get['news_path'] = $news_path;
				}
			
				$this->request->get['route'] = 'information/uni_news_story';
				
			} elseif(isset($this->request->get['news_path'])){
				$this->request->get['route'] = 'information/uni_news';
			}
			
			if (isset($this->request->get['gallery_id'])) {
				$this->request->get['route'] = 'information/uni_gallery';
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[case 'path':]]></search>
			<add position="before"><![CDATA[
			case 'news_path':
				$news_categories = explode('_', $value);
				foreach ($news_categories as $news_category_id) {
					$queries[] = 'news_category_id='.(int)$news_category_id;
				}
				unset($data[$key]);
				break;	
			case 'news_id':
				$news_id = (int)$value;
				$queries[] = 'news_id='.(int)$news_id;
				$postfix = true;
				unset($data[$key]);
				break;
			case 'gallery_id':
				$gallery_id = (int)$value;
				$queries[] = 'gallery_id='.(int)$gallery_id;
				$postfix = true;
				unset($data[$key]);
				break;
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[case 'product/category':]]></search>
			<add position="before"><![CDATA[
			case 'information/uni_news_story':
				if (isset($data['news_id'])) {
					$news_id = (int)$data['news_id'];
					
					unset($data);
					
					if ($this->config->get('config_seo_url_include_path')) {
						$data['news_path'] = $this->getPathByUniNewsStory($news_id);
					}	
					
					$data['news_id'] = $news_id;
				}
				break;
			case 'information/uni_news':
				if (isset($data['news_path'])) {
					$category = explode('_', $data['news_path']);
					$category = end($category);
					$data['news_path'] = $this->getPathByUniNewsCategory($category);
				}
				break;
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[private function getPathByCategory]]></search>
			<add position="before"><![CDATA[
			private function getPathByUniNewsStory($news_id) {
				$news_id = (int)$news_id;
			
				if ($news_id < 1) return false;
				
				$cache_name = 'seopro.unishop.news.story';
		
				$path = $this->config->get('config_seo_url_cache') ? $this->cache->get($cache_name) : [];
		
				if (!isset($path[$news_id])) {
					$query = $this->db->query("SELECT category_id FROM `".DB_PREFIX."uni_news_story_to_category` WHERE news_id = '".$news_id."' ORDER BY category_id DESC LIMIT 1");
					$path[$news_id] = $this->getPathByUniNewsCategory($query->num_rows ? (int)$query->row['category_id'] : 0);
			
					if($this->config->get('config_seo_url_cache')) {
						$this->cache->set($cache_name, $path);
					}
				}
		
				return $path[$news_id];
			}

			private function getPathByUniNewsCategory($category_id) {
				$category_id = (int)$category_id;
				
				if($category_id < 1) return false;
				
				$cache_name = 'seopro.unishop.news.category';
		
				$path = $this->config->get('config_seo_url_cache') ? $this->cache->get($cache_name) : [];
				
				if (!isset($path[$category_id])) {			
					$level = 10;

					$sql = "SELECT CONCAT_WS('_'";
				
					for ($i = $level-1; $i >= 0; --$i) {
						$sql .= ",t$i.category_id";
					}
				
					$sql .= ") AS path FROM `".DB_PREFIX."uni_news_category` t0";
				
					for ($i = 1; $i < $level; ++$i) {
						$sql .= " LEFT JOIN `".DB_PREFIX."uni_news_category` t$i ON (t$i.category_id = t".($i-1).".parent_id)";
					}
				
					$sql .= " WHERE t0.category_id = '".$category_id."'";

					$query = $this->db->query($sql);				
					$path[$category_id] = $query->num_rows ? $query->row['path'] : false;
			
					if($this->config->get('config_seo_url_cache')) {
						$this->cache->set($cache_name, $path);
					}
				}
		
				return $path[$category_id];
			}
			]]></add>
		</operation>
    </file>
	
	<!-- for admin panel -->
	
	<file path="admin/controller/common/column_left.php">
		<operation error="skip">
			<search><![CDATA[$catalog = array();]]></search>
			<add position="before"><![CDATA[
			$this->load->language('extension/module/uni_settings');
			
			$unishop = $uni_news = $uni_request = $uni_gallery = [];
			$user_token = $this->session->data['user_token'];
			
			if ($this->user->hasPermission('access', 'extension/module/uni_settings') && $this->config->get('theme_unishop2_key')) {		
				$unishop[] = [
					'name'	   => $this->language->get('text_unishop_settings'),
					'href'     => $this->url->link('extension/module/uni_settings', 'user_token=' . $user_token, true),
					'children' => []		
				];					
			}
			
			if ($this->user->hasPermission('access', 'extension/module/uni_news')) {				
				$uni_news[] = [
					'name'	   => $this->language->get('text_news_new'),
					'href'     => $this->url->link('extension/module/uni_news/insert', 'user_token='.$user_token, true),
					'children' => []		
				];
			
				$uni_news[] = [
					'name'	   => $this->language->get('text_news_all'),
					'href'     => $this->url->link('extension/module/uni_news/listing', 'user_token='.$user_token, true),
					'children' => []		
				];
				
				$uni_news[] = [
					'name'	   => $this->language->get('text_news_cat'),
					'href'     => $this->url->link('extension/module/uni_news/category_list', 'user_token='.$user_token, true),
					'children' => []		
				];
				
				$uni_news[] = [
					'name'	   => $this->language->get('text_news_setting'),
					'href'     => $this->url->link('extension/module/uni_news/setting', 'user_token='.$user_token, true),
					'children' => []		
				];
			
				$unishop[] = [
					'name'	   => $this->language->get('text_news'),
					'href'     => '',
					'children' => $uni_news		
				];	
			}
			
			if ($this->config->get('uni_request') && $this->user->hasPermission('access', 'extension/module/uni_request')) {
				$this->load->language('extension/module/uni_request');
				
				$this->load->model('extension/module/uni_request');
				$this->load->controller('extension/module/uni_request/install');
				$this->load->controller('extension/module/uni_request/check');
			
				$uni_request[] = [
					'name'	   => $this->language->get('text_status_1').' ('.$this->model_extension_module_uni_request->getNewRequests().')',
					'href'     => $this->url->link('extension/module/uni_request&filter_status=1', 'user_token=' . $user_token, true),
					'children' => []		
				];
			
				$uni_request[] = [
					'name'	   => $this->language->get('text_status_2').' ('.$this->model_extension_module_uni_request->getProcessingRequests().')',
					'href'     => $this->url->link('extension/module/uni_request&filter_status=2', 'user_token=' . $user_token, true),
					'children' => []		
				];
			
				$uni_request[] = [
					'name'	   => $this->language->get('text_total_requests').' ('.$this->model_extension_module_uni_request->getTotalRequests().')',
					'href'     => $this->url->link('extension/module/uni_request', 'user_token=' . $user_token, true),
					'children' => []		
				];
				
				$uni_request[] = [
					'name'	   => $this->language->get('text_requests_setting'),
					'href'     => $this->url->link('extension/module/uni_request/setting', 'user_token=' . $user_token, true),
					'children' => []		
				];
			
				$unishop[] = [
					'name'	   => $this->language->get('text_requests'),
					'href'     => '',
					'children' => $uni_request
				];
			}
			
			if ($this->user->hasPermission('access', 'extension/module/uni_gallery')) {
				$uni_gallery[] = [
					'name'	   => $this->language->get('text_gallery_new'),
					'href'     => $this->url->link('extension/module/uni_gallery/insert', 'user_token='.$user_token, true),
					'children' => []		
				];
			
				$uni_gallery[] = [
					'name'	   => $this->language->get('text_gallery_all'),
					'href'     => $this->url->link('extension/module/uni_gallery/getList', 'user_token='.$user_token, true),
					'children' => []		
				];
				
				$uni_gallery[] = [
					'name'	   => $this->language->get('text_gallery_setting'),
					'href'     => $this->url->link('extension/module/uni_gallery/setting', 'user_token='.$user_token, true),
					'children' => []		
				];
			
				$unishop[] = [
					'name'	   => $this->language->get('text_gallery'),
					'href'     => '',
					'children' => $uni_gallery	
				];	
			}
			
			if ($unishop) {
				$data['menus'][] = [
					'id'       => 'menu-unishop',
					'icon'	   => 'fa-cogs', 
					'name'	   => $this->language->get('text_unishop'),
					'href'     => '',
					'children' => $unishop
				];		
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/model/catalog/review.php">
		<operation error="skip">
			<search><![CDATA[public function addReview($data)]]></search>
			<add position="before"><![CDATA[
			public function checkAdminReply() {
				$plus = $this->db->query("show columns FROM ".DB_PREFIX."review WHERE Field = 'plus'");
				if (!$plus->num_rows) { 
					$this->db->query("ALTER TABLE `".DB_PREFIX."review` ADD `plus` TEXT CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT '' AFTER `text`");
				} 
				
				$minus = $this->db->query("show columns FROM ".DB_PREFIX."review WHERE Field = 'minus'");
				if (!$minus->num_rows) { 
					$this->db->query("ALTER TABLE `".DB_PREFIX."review` ADD `minus` TEXT CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT '' AFTER `text`");
				} 
				
				$admin_reply = $this->db->query("show columns FROM ".DB_PREFIX."review WHERE Field = 'admin_reply'");
				if (!$admin_reply->num_rows) { 
					$this->db->query("ALTER TABLE `".DB_PREFIX."review` ADD `admin_reply` TEXT CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT '' AFTER `text`");
				}
				
				$votes_plus = $this->db->query("show columns FROM ".DB_PREFIX."review WHERE Field = 'votes_plus'");
				if (!$votes_plus->num_rows) { 
					$this->db->query("ALTER TABLE `".DB_PREFIX."review` ADD `votes_plus` int(11) NOT NULL DEFAULT 0 AFTER admin_reply, ADD `votes_minus` int(11) NOT NULL DEFAULT 0 AFTER admin_reply");
				}
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[, rating =]]></search>
			<add position="replace"><![CDATA[, plus = '".$this->db->escape(strip_tags($data['plus']))."', minus = '".$this->db->escape(strip_tags($data['minus']))."', admin_reply = '".$this->db->escape(strip_tags($data['admin_reply']))."', votes_plus = '".(int)$data['votes_plus']."', votes_minus = '".(int)$data['votes_minus']."', rating =]]></add>
		</operation>
	</file>
	<file path="admin/controller/catalog/review.php">
		<operation error="skip">
			<search><![CDATA[public function index()]]></search>
			<add position="after"><![CDATA[
			$this->load->model('catalog/review');
			$this->model_catalog_review->checkAdminReply();
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if (isset($this->request->post['rating'])) {]]></search>
			<add position="before"><![CDATA[
			$this->load->language('extension/module/uni_reviews');
			
			if (isset($this->request->post['plus'])) {
				$data['plus'] = $this->request->post['plus'];
			} elseif (!empty($review_info)) {
				$data['plus'] = $review_info['plus'];
			} else {
				$data['plus'] = '';
			}
			
			if (isset($this->request->post['minus'])) {
				$data['minus'] = $this->request->post['minus'];
			} elseif (!empty($review_info)) {
				$data['minus'] = $review_info['minus'];
			} else {
				$data['minus'] = '';
			}
			
			if (isset($this->request->post['admin_reply'])) {
				$data['admin_reply'] = $this->request->post['admin_reply'];
			} elseif (!empty($review_info)) {
				$data['admin_reply'] = $review_info['admin_reply'];
			} else {
				$data['admin_reply'] = '';
			}
			
			if (isset($this->request->post['votes_plus'])) {
				$data['votes_plus'] = $this->request->post['votes_plus'];
			} elseif (!empty($review_info)) {
				$data['votes_plus'] = $review_info['votes_plus'];
			} else {
				$data['votes_plus'] = 0;
			}
			
			if (isset($this->request->post['votes_minus'])) {
				$data['votes_minus'] = $this->request->post['votes_minus'];
			} elseif (!empty($review_info)) {
				$data['votes_minus'] = $review_info['votes_minus'];
			} else {
				$data['votes_minus'] = 0;
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/view/template/catalog/review_form.twig">
		<operation error="skip">
			<search><![CDATA[<label class="col-sm-2 control-label" for="input-text">]]></search>
			<add position="before" offset="1"><![CDATA[
			<div class="form-group required">
				<label class="col-sm-2 control-label" for="input-plus">{{ entry_plus }}</label>
				<div class="col-sm-10">
					<textarea name="plus" cols="60" rows="8" placeholder="{{ entry_plus }}" id="input-text" class="form-control">{{ plus }}</textarea>
				</div>
			</div>
			<div class="form-group required">
				<label class="col-sm-2 control-label" for="input-minus">{{ entry_minus }}</label>
				<div class="col-sm-10">
					<textarea name="minus" cols="60" rows="8" placeholder="{{ entry_minus }}" id="input-text" class="form-control">{{ minus }}</textarea>
				</div>
			</div>
			<div class="form-group required">
				<label class="col-sm-2 control-label" for="input-admin_reply">{{ entry_admin_reply }}</label>
				<div class="col-sm-10">
					<textarea name="admin_reply" cols="60" rows="8" placeholder="{{ entry_admin_reply }}" id="input-text" class="form-control">{{ admin_reply }}</textarea>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-admin_reply">{{ entry_votes }}</label>
				<div class="col-sm-10">
					<input name="votes_plus" value="{{ votes_plus }}" class="form-control" style="display:inline-block;width:60px">&nbsp;&nbsp;
					<input name="votes_minus" value="{{ votes_minus }}" class="form-control" style="display:inline-block;width:60px">
				</div>
			</div>
			]]></add>
		</operation>
	</file>
	<file path="admin/controller/extension/extension/module.php">
		<operation error="skip">
			<search><![CDATA[$files = glob(DIR_APPLICATION . 'controller/extension/module/*.php');]]></search>
			<add position="after"><![CDATA[
			if(($key = array_search(DIR_APPLICATION.'controller/extension/module/uni_part1.php', $files)) !== FALSE){
				unset($files[$key]);
			}
			if(($key = array_search(DIR_APPLICATION.'controller/extension/module/uni_part2.php', $files)) !== FALSE){
				unset($files[$key]);
			}
			]]></add>
		</operation>
	</file>
</modification>